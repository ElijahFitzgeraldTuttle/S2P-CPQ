import { db } from '../server/db';
import { upteamPricingMatrix } from '../shared/schema';
import { eq, and } from 'drizzle-orm';

const AREA_TIERS = [
  '0-5k',
  '5k-10k',
  '10k-20k',
  '20k-30k',
  '30k-40k',
  '40k-50k',
  '50k-75k',
  '75k-100k',
  '100k+'
];

const DISCIPLINES = ['architecture', 'structure', 'mepf', 'site'];
const LODS = ['200', '300', '350', '350+'];

interface PricingData {
  [buildingTypeId: number]: {
    [areaTier: string]: {
      architecture: number[];
      structure: number[];
      mepf: number[];
      site: number[];
    }
  }
}

const pricingData: PricingData = {
  1: { // Residential Standard (Single Family)
    '0-5k': { architecture: [0.110, 0.150, 0.197, 0.238], structure: [0.035, 0.055, 0.065, 0.075], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.012, 0.015, 0.020] },
    '5k-10k': { architecture: [0.105, 0.145, 0.186, 0.225], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.012, 0.015, 0.020] },
    '10k-20k': { architecture: [0.100, 0.140, 0.180, 0.218], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.011, 0.013, 0.018] },
    '20k-30k': { architecture: [0.095, 0.135, 0.166, 0.192], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.011, 0.013, 0.018] },
    '30k-40k': { architecture: [0.095, 0.130, 0.166, 0.191], structure: [0.015, 0.035, 0.040, 0.050], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.012, 0.016] },
    '40k-50k': { architecture: [0.090, 0.125, 0.160, 0.185], structure: [0.015, 0.030, 0.035, 0.045], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.012, 0.016] },
    '50k-75k': { architecture: [0.075, 0.115, 0.132, 0.152], structure: [0.010, 0.025, 0.030, 0.040], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.012, 0.014] },
    '75k-100k': { architecture: [0.055, 0.085, 0.111, 0.128], structure: [0.010, 0.020, 0.025, 0.035], mepf: [0.010, 0.020, 0.025, 0.030], site: [0.010, 0.010, 0.010, 0.014] },
    '100k+': { architecture: [0.040, 0.060, 0.074, 0.086], structure: [0.010, 0.015, 0.020, 0.030], mepf: [0.010, 0.015, 0.020, 0.025], site: [0.010, 0.010, 0.010, 0.012] },
  },
  2: { // Residential Standard (Multi Family)
    '0-5k': { architecture: [0.120, 0.160, 0.207, 0.248], structure: [0.040, 0.060, 0.070, 0.080], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.012, 0.015, 0.020] },
    '5k-10k': { architecture: [0.115, 0.155, 0.196, 0.235], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.012, 0.015, 0.020] },
    '10k-20k': { architecture: [0.110, 0.150, 0.190, 0.228], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.011, 0.013, 0.018] },
    '20k-30k': { architecture: [0.100, 0.135, 0.176, 0.202], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.011, 0.013, 0.018] },
    '30k-40k': { architecture: [0.095, 0.130, 0.171, 0.196], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.010, 0.012, 0.016] },
    '40k-50k': { architecture: [0.090, 0.125, 0.165, 0.190], structure: [0.015, 0.035, 0.040, 0.050], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.012, 0.016] },
    '50k-75k': { architecture: [0.080, 0.120, 0.137, 0.157], structure: [0.010, 0.030, 0.035, 0.045], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.012, 0.014] },
    '75k-100k': { architecture: [0.060, 0.090, 0.116, 0.133], structure: [0.010, 0.025, 0.030, 0.040], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.010, 0.014] },
    '100k+': { architecture: [0.045, 0.065, 0.079, 0.091], structure: [0.010, 0.020, 0.025, 0.035], mepf: [0.010, 0.020, 0.025, 0.030], site: [0.010, 0.010, 0.010, 0.012] },
  },
  3: { // Residential Luxury
    '0-5k': { architecture: [0.135, 0.175, 0.222, 0.263], structure: [0.050, 0.070, 0.080, 0.090], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.015, 0.017, 0.020, 0.025] },
    '5k-10k': { architecture: [0.130, 0.170, 0.211, 0.250], structure: [0.045, 0.065, 0.070, 0.080], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.015, 0.017, 0.020, 0.025] },
    '10k-20k': { architecture: [0.125, 0.165, 0.205, 0.243], structure: [0.040, 0.060, 0.065, 0.075], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.015, 0.016, 0.018, 0.023] },
    '20k-30k': { architecture: [0.120, 0.160, 0.191, 0.217], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.015, 0.016, 0.018, 0.023] },
    '30k-40k': { architecture: [0.110, 0.150, 0.181, 0.206], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.015, 0.015, 0.017, 0.021] },
    '40k-50k': { architecture: [0.105, 0.145, 0.175, 0.200], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.015, 0.015, 0.017, 0.021] },
    '50k-75k': { architecture: [0.090, 0.130, 0.147, 0.167], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.015, 0.015, 0.017, 0.019] },
    '75k-100k': { architecture: [0.070, 0.100, 0.126, 0.143], structure: [0.020, 0.035, 0.040, 0.050], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.015, 0.015, 0.015, 0.019] },
    '100k+': { architecture: [0.055, 0.075, 0.089, 0.101], structure: [0.020, 0.030, 0.035, 0.045], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.015, 0.015, 0.015, 0.017] },
  },
  4: { // Commercial/Office
    '0-5k': { architecture: [0.105, 0.145, 0.192, 0.233], structure: [0.045, 0.065, 0.075, 0.085], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.010, 0.012, 0.015, 0.020] },
    '5k-10k': { architecture: [0.100, 0.140, 0.181, 0.220], structure: [0.040, 0.060, 0.065, 0.075], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.010, 0.012, 0.015, 0.020] },
    '10k-20k': { architecture: [0.095, 0.135, 0.175, 0.213], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.011, 0.013, 0.018] },
    '20k-30k': { architecture: [0.090, 0.130, 0.161, 0.187], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.011, 0.013, 0.018] },
    '30k-40k': { architecture: [0.080, 0.120, 0.156, 0.181], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.010, 0.012, 0.016] },
    '40k-50k': { architecture: [0.070, 0.115, 0.150, 0.175], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.010, 0.010, 0.012, 0.016] },
    '50k-75k': { architecture: [0.065, 0.105, 0.122, 0.142], structure: [0.015, 0.035, 0.040, 0.050], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.010, 0.010, 0.012, 0.014] },
    '75k-100k': { architecture: [0.045, 0.075, 0.101, 0.118], structure: [0.015, 0.030, 0.035, 0.045], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.010, 0.010, 0.010, 0.014] },
    '100k+': { architecture: [0.030, 0.050, 0.064, 0.076], structure: [0.015, 0.025, 0.030, 0.040], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.010, 0.010, 0.012] },
  },
  5: { // Retail/Restaurants/Cafe
    '0-5k': { architecture: [0.130, 0.170, 0.217, 0.258], structure: [0.035, 0.055, 0.065, 0.075], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.012, 0.015, 0.020] },
    '5k-10k': { architecture: [0.125, 0.165, 0.206, 0.245], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.012, 0.015, 0.020] },
    '10k-20k': { architecture: [0.120, 0.160, 0.200, 0.238], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.010, 0.011, 0.013, 0.018] },
    '20k-30k': { architecture: [0.110, 0.150, 0.186, 0.212], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.010, 0.011, 0.013, 0.018] },
    '30k-40k': { architecture: [0.110, 0.135, 0.176, 0.201], structure: [0.015, 0.035, 0.040, 0.050], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.010, 0.010, 0.012, 0.016] },
    '40k-50k': { architecture: [0.095, 0.130, 0.170, 0.195], structure: [0.015, 0.030, 0.035, 0.045], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.010, 0.012, 0.016] },
    '50k-75k': { architecture: [0.085, 0.125, 0.142, 0.162], structure: [0.010, 0.025, 0.030, 0.040], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.010, 0.012, 0.014] },
    '75k-100k': { architecture: [0.065, 0.095, 0.121, 0.138], structure: [0.010, 0.020, 0.025, 0.035], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.010, 0.010, 0.014] },
    '100k+': { architecture: [0.050, 0.070, 0.084, 0.096], structure: [0.010, 0.015, 0.020, 0.030], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.010, 0.010, 0.012] },
  },
  6: { // Kitchen space/ Catering Kitchen
    '0-5k': { architecture: [0.105, 0.145, 0.192, 0.233], structure: [0.050, 0.070, 0.080, 0.090], mepf: [0.045, 0.055, 0.060, 0.065], site: [0.010, 0.012, 0.015, 0.020] },
    '5k-10k': { architecture: [0.100, 0.140, 0.181, 0.220], structure: [0.045, 0.065, 0.070, 0.080], mepf: [0.045, 0.055, 0.060, 0.065], site: [0.010, 0.012, 0.015, 0.020] },
    '10k-20k': { architecture: [0.095, 0.135, 0.175, 0.213], structure: [0.040, 0.060, 0.065, 0.075], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.010, 0.011, 0.013, 0.018] },
    '20k-30k': { architecture: [0.090, 0.130, 0.161, 0.187], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.010, 0.011, 0.013, 0.018] },
    '30k-40k': { architecture: [0.085, 0.125, 0.156, 0.181], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.010, 0.010, 0.012, 0.016] },
    '40k-50k': { architecture: [0.080, 0.120, 0.150, 0.175], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.010, 0.012, 0.016] },
    '50k-75k': { architecture: [0.065, 0.105, 0.122, 0.142], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.010, 0.012, 0.014] },
    '75k-100k': { architecture: [0.045, 0.075, 0.101, 0.118], structure: [0.020, 0.035, 0.040, 0.050], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.010, 0.010, 0.014] },
    '100k+': { architecture: [0.030, 0.050, 0.064, 0.076], structure: [0.020, 0.030, 0.035, 0.045], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.010, 0.010, 0.010, 0.012] },
  },
  7: { // Schools/ College Campus/ Education Building
    '0-5k': { architecture: [0.115, 0.155, 0.202, 0.243], structure: [0.040, 0.060, 0.070, 0.080], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.020, 0.022, 0.025, 0.030] },
    '5k-10k': { architecture: [0.110, 0.150, 0.191, 0.230], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.020, 0.022, 0.025, 0.030] },
    '10k-20k': { architecture: [0.105, 0.145, 0.185, 0.223], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.020, 0.021, 0.023, 0.028] },
    '20k-30k': { architecture: [0.100, 0.140, 0.171, 0.197], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.020, 0.021, 0.023, 0.028] },
    '30k-40k': { architecture: [0.090, 0.125, 0.166, 0.191], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.020, 0.020, 0.022, 0.026] },
    '40k-50k': { architecture: [0.085, 0.120, 0.160, 0.185], structure: [0.015, 0.035, 0.040, 0.050], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.020, 0.020, 0.022, 0.026] },
    '50k-75k': { architecture: [0.070, 0.110, 0.132, 0.152], structure: [0.010, 0.030, 0.035, 0.045], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.020, 0.020, 0.022, 0.024] },
    '75k-100k': { architecture: [0.055, 0.085, 0.111, 0.128], structure: [0.010, 0.025, 0.030, 0.040], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.020, 0.020, 0.020, 0.024] },
    '100k+': { architecture: [0.040, 0.060, 0.074, 0.086], structure: [0.010, 0.020, 0.025, 0.035], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.020, 0.020, 0.020, 0.022] },
  },
  8: { // Hotel/Theatre/Museum
    '0-5k': { architecture: [0.135, 0.175, 0.222, 0.263], structure: [0.050, 0.070, 0.080, 0.090], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.015, 0.017, 0.020, 0.025] },
    '5k-10k': { architecture: [0.130, 0.170, 0.211, 0.250], structure: [0.045, 0.065, 0.070, 0.080], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.015, 0.017, 0.020, 0.025] },
    '10k-20k': { architecture: [0.125, 0.165, 0.205, 0.243], structure: [0.040, 0.060, 0.065, 0.075], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.015, 0.016, 0.018, 0.023] },
    '20k-30k': { architecture: [0.115, 0.145, 0.191, 0.217], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.015, 0.016, 0.018, 0.023] },
    '30k-40k': { architecture: [0.105, 0.140, 0.181, 0.206], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.015, 0.015, 0.017, 0.021] },
    '40k-50k': { architecture: [0.095, 0.125, 0.175, 0.200], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.015, 0.015, 0.017, 0.021] },
    '50k-75k': { architecture: [0.080, 0.120, 0.147, 0.167], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.015, 0.015, 0.017, 0.019] },
    '75k-100k': { architecture: [0.060, 0.100, 0.126, 0.143], structure: [0.020, 0.035, 0.040, 0.050], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.015, 0.015, 0.015, 0.019] },
    '100k+': { architecture: [0.055, 0.075, 0.089, 0.101], structure: [0.020, 0.030, 0.035, 0.045], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.015, 0.015, 0.015, 0.017] },
  },
  9: { // Hospitals/ Mixed use
    '0-5k': { architecture: [0.105, 0.145, 0.192, 0.233], structure: [0.045, 0.065, 0.075, 0.085], mepf: [0.045, 0.055, 0.060, 0.065], site: [0.015, 0.017, 0.020, 0.025] },
    '5k-10k': { architecture: [0.100, 0.140, 0.181, 0.220], structure: [0.040, 0.060, 0.065, 0.075], mepf: [0.045, 0.055, 0.060, 0.065], site: [0.015, 0.017, 0.020, 0.025] },
    '10k-20k': { architecture: [0.095, 0.135, 0.175, 0.213], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.015, 0.016, 0.018, 0.023] },
    '20k-30k': { architecture: [0.090, 0.130, 0.161, 0.187], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.015, 0.016, 0.018, 0.023] },
    '30k-40k': { architecture: [0.085, 0.120, 0.161, 0.186], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.015, 0.015, 0.017, 0.021] },
    '40k-50k': { architecture: [0.080, 0.115, 0.155, 0.180], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.015, 0.015, 0.017, 0.021] },
    '50k-75k': { architecture: [0.070, 0.110, 0.127, 0.147], structure: [0.015, 0.035, 0.040, 0.050], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.015, 0.015, 0.017, 0.019] },
    '75k-100k': { architecture: [0.050, 0.080, 0.106, 0.123], structure: [0.015, 0.030, 0.035, 0.045], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.015, 0.015, 0.015, 0.019] },
    '100k+': { architecture: [0.035, 0.055, 0.069, 0.081], structure: [0.015, 0.025, 0.030, 0.040], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.015, 0.015, 0.015, 0.017] },
  },
  10: { // Mechanical Room/Utility Room (MEPF)
    '0-5k': { architecture: [0.095, 0.135, 0.182, 0.223], structure: [0.040, 0.060, 0.070, 0.080], mepf: [0.090, 0.100, 0.105, 0.110], site: [0.010, 0.012, 0.015, 0.020] },
    '5k-10k': { architecture: [0.090, 0.130, 0.171, 0.210], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.090, 0.100, 0.105, 0.110], site: [0.010, 0.012, 0.015, 0.020] },
    '10k-20k': { architecture: [0.085, 0.125, 0.165, 0.203], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.085, 0.095, 0.100, 0.105], site: [0.010, 0.011, 0.013, 0.018] },
    '20k-30k': { architecture: [0.080, 0.120, 0.151, 0.177], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.085, 0.095, 0.100, 0.105], site: [0.010, 0.011, 0.013, 0.018] },
    '30k-40k': { architecture: [0.085, 0.125, 0.156, 0.181], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.065, 0.075, 0.080, 0.085], site: [0.010, 0.010, 0.012, 0.016] },
    '40k-50k': { architecture: [0.080, 0.120, 0.150, 0.175], structure: [0.015, 0.035, 0.040, 0.050], mepf: [0.060, 0.070, 0.075, 0.080], site: [0.010, 0.010, 0.012, 0.016] },
    '50k-75k': { architecture: [0.065, 0.105, 0.122, 0.142], structure: [0.010, 0.030, 0.035, 0.045], mepf: [0.060, 0.070, 0.075, 0.080], site: [0.010, 0.010, 0.012, 0.014] },
    '75k-100k': { architecture: [0.045, 0.075, 0.101, 0.118], structure: [0.010, 0.025, 0.030, 0.040], mepf: [0.060, 0.070, 0.075, 0.080], site: [0.010, 0.010, 0.010, 0.014] },
    '100k+': { architecture: [0.030, 0.050, 0.064, 0.076], structure: [0.010, 0.020, 0.025, 0.035], mepf: [0.055, 0.065, 0.070, 0.075], site: [0.010, 0.010, 0.010, 0.012] },
  },
  11: { // Warehouse/Storage/Fulfillment centre
    '0-5k': { architecture: [0.095, 0.135, 0.182, 0.223], structure: [0.070, 0.090, 0.100, 0.110], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.010, 0.012, 0.015, 0.020] },
    '5k-10k': { architecture: [0.090, 0.130, 0.171, 0.210], structure: [0.065, 0.085, 0.090, 0.100], mepf: [0.040, 0.050, 0.055, 0.060], site: [0.010, 0.012, 0.015, 0.020] },
    '10k-20k': { architecture: [0.085, 0.125, 0.165, 0.203], structure: [0.060, 0.080, 0.085, 0.095], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.011, 0.013, 0.018] },
    '20k-30k': { architecture: [0.070, 0.110, 0.151, 0.177], structure: [0.055, 0.075, 0.080, 0.090], mepf: [0.035, 0.045, 0.050, 0.055], site: [0.010, 0.011, 0.013, 0.018] },
    '30k-40k': { architecture: [0.065, 0.100, 0.151, 0.176], structure: [0.040, 0.060, 0.065, 0.075], mepf: [0.030, 0.040, 0.045, 0.050], site: [0.010, 0.010, 0.012, 0.016] },
    '40k-50k': { architecture: [0.060, 0.090, 0.145, 0.170], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.010, 0.012, 0.016] },
    '50k-75k': { architecture: [0.050, 0.085, 0.117, 0.137], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.010, 0.012, 0.014] },
    '75k-100k': { architecture: [0.040, 0.055, 0.096, 0.113], structure: [0.030, 0.045, 0.050, 0.060], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.010, 0.010, 0.014] },
    '100k+': { architecture: [0.025, 0.045, 0.059, 0.071], structure: [0.030, 0.040, 0.045, 0.055], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.010, 0.010, 0.012] },
  },
  12: { // Church/Temples/Religious building
    '0-5k': { architecture: [0.130, 0.170, 0.217, 0.258], structure: [0.040, 0.060, 0.070, 0.080], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.012, 0.015, 0.020] },
    '5k-10k': { architecture: [0.125, 0.165, 0.206, 0.245], structure: [0.035, 0.055, 0.060, 0.070], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.010, 0.012, 0.015, 0.020] },
    '10k-20k': { architecture: [0.120, 0.160, 0.200, 0.238], structure: [0.030, 0.050, 0.055, 0.065], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.011, 0.013, 0.018] },
    '20k-30k': { architecture: [0.115, 0.155, 0.186, 0.212], structure: [0.025, 0.045, 0.050, 0.060], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.011, 0.013, 0.018] },
    '30k-40k': { architecture: [0.105, 0.145, 0.176, 0.201], structure: [0.020, 0.040, 0.045, 0.055], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.010, 0.010, 0.012, 0.016] },
    '40k-50k': { architecture: [0.100, 0.140, 0.170, 0.195], structure: [0.015, 0.035, 0.040, 0.050], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.012, 0.016] },
    '50k-75k': { architecture: [0.085, 0.125, 0.142, 0.162], structure: [0.010, 0.030, 0.035, 0.045], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.012, 0.014] },
    '75k-100k': { architecture: [0.065, 0.095, 0.121, 0.138], structure: [0.010, 0.025, 0.030, 0.040], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.010, 0.010, 0.010, 0.014] },
    '100k+': { architecture: [0.050, 0.070, 0.084, 0.096], structure: [0.010, 0.020, 0.025, 0.035], mepf: [0.010, 0.020, 0.025, 0.030], site: [0.010, 0.010, 0.010, 0.012] },
  },
  13: { // Infrastructure/Roads/Bridges
    '0-5k': { architecture: [0.040, 0.060, 0.070, 0.080], structure: [0.120, 0.160, 0.180, 0.200], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.020, 0.022, 0.025, 0.030] },
    '5k-10k': { architecture: [0.035, 0.055, 0.060, 0.070], structure: [0.115, 0.155, 0.170, 0.190], mepf: [0.025, 0.035, 0.040, 0.045], site: [0.020, 0.022, 0.025, 0.030] },
    '10k-20k': { architecture: [0.030, 0.050, 0.055, 0.065], structure: [0.110, 0.150, 0.165, 0.180], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.020, 0.021, 0.023, 0.028] },
    '20k-30k': { architecture: [0.025, 0.045, 0.050, 0.060], structure: [0.105, 0.145, 0.160, 0.170], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.020, 0.021, 0.023, 0.028] },
    '30k-40k': { architecture: [0.020, 0.040, 0.045, 0.055], structure: [0.100, 0.140, 0.155, 0.160], mepf: [0.020, 0.030, 0.035, 0.040], site: [0.020, 0.020, 0.022, 0.026] },
    '40k-50k': { architecture: [0.015, 0.035, 0.040, 0.050], structure: [0.095, 0.135, 0.150, 0.155], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.020, 0.020, 0.022, 0.026] },
    '50k-75k': { architecture: [0.010, 0.030, 0.035, 0.045], structure: [0.080, 0.120, 0.130, 0.135], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.020, 0.020, 0.022, 0.024] },
    '75k-100k': { architecture: [0.010, 0.025, 0.030, 0.040], structure: [0.060, 0.090, 0.110, 0.120], mepf: [0.015, 0.025, 0.030, 0.035], site: [0.020, 0.020, 0.020, 0.024] },
    '100k+': { architecture: [0.010, 0.020, 0.025, 0.035], structure: [0.045, 0.065, 0.075, 0.085], mepf: [0.010, 0.020, 0.025, 0.030], site: [0.020, 0.020, 0.020, 0.022] },
  },
};

async function updateUpteamPricing() {
  console.log('Starting upteam pricing matrix update...');
  
  let updateCount = 0;
  let insertCount = 0;
  let errorCount = 0;

  for (const [buildingTypeIdStr, tierData] of Object.entries(pricingData)) {
    const buildingTypeId = parseInt(buildingTypeIdStr);
    
    for (const [areaTier, disciplines] of Object.entries(tierData)) {
      for (const [discipline, rates] of Object.entries(disciplines)) {
        for (let lodIdx = 0; lodIdx < LODS.length; lodIdx++) {
          const lod = LODS[lodIdx];
          const rate = rates[lodIdx];
          
          try {
            const [existing] = await db
              .select()
              .from(upteamPricingMatrix)
              .where(
                and(
                  eq(upteamPricingMatrix.buildingTypeId, buildingTypeId),
                  eq(upteamPricingMatrix.areaTier, areaTier),
                  eq(upteamPricingMatrix.discipline, discipline),
                  eq(upteamPricingMatrix.lod, lod)
                )
              )
              .limit(1);

            if (existing) {
              await db
                .update(upteamPricingMatrix)
                .set({ 
                  ratePerSqFt: rate.toFixed(4),
                  updatedAt: new Date()
                })
                .where(eq(upteamPricingMatrix.id, existing.id));
              updateCount++;
            } else {
              await db.insert(upteamPricingMatrix).values({
                buildingTypeId,
                areaTier,
                discipline,
                lod,
                ratePerSqFt: rate.toFixed(4),
                createdAt: new Date(),
                updatedAt: new Date()
              });
              insertCount++;
            }
          } catch (error) {
            console.error(`Error processing: Building ${buildingTypeId}, ${areaTier}, ${discipline}, LOD ${lod}:`, error);
            errorCount++;
          }
        }
      }
    }
  }

  console.log(`\nUpteam pricing update complete:`);
  console.log(`  Updated: ${updateCount} records`);
  console.log(`  Inserted: ${insertCount} records`);
  console.log(`  Errors: ${errorCount}`);
  console.log(`  Total processed: ${updateCount + insertCount + errorCount}`);
  
  process.exit(0);
}

updateUpteamPricing().catch((error) => {
  console.error('Update failed:', error);
  process.exit(1);
});
