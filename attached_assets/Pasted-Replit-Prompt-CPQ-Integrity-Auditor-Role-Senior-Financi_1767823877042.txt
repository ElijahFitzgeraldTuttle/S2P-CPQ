Replit Prompt: CPQ Integrity Auditor
Role: Senior Financial Systems Engineer

Objective: Build a middleware "Auditor" that validates the CPQ payload against internal pricing guardrails before allowing a proposal to be finalized.

1. The Policy Anchor (PRICING_GUARDRAILS.json)
Create a central configuration file that defines the "Hard Red Lines" the AI must check:

Margin Floor: Minimum allowable gross_margin (e.g., 45%).

Risk/Travel Match: If travel.scenario is "Fly-out," the customTravelCost cannot be $0.

LoD Premium: Ensure the price difference between LoD 300 and 350 matches the expected % increase for that building type.

2. The Validation Drawer (The "Pre-Flight Check")
Trigger: When the user clicks "Save Quote" or "Generate Proposal" in the CPQ iframe.

Action: Intercept the CPQ_QUOTE_SAVED message.

UI: Display a "Proposal Integrity Audit" sidebar.

Check 1: Logic Check. "The sqft is 50k, but the scan duration is only 2 hours. This is physically impossible. Please verify."

Check 2: Policy Check. "This quote has a 38% margin. Our policy minimum is 45%. CEO override required."

Check 3: Historical Check. "This price per sqft is 15% lower than our last 3 projects for this client."

3. The "CEO Override" Workflow
Gate: If the Auditor finds a "Red Flag," the "Download Proposal" button is disabled.

Approval: A "Request Exception" button appears. Clicking it sends a notification to the CEO/Admin with the specific flags. Once approved in the OS, the "Download" button unlocks.

4. Grounding with the Square Foot Audit
If this project address has been scanned before (check universal_id history), the Auditor must verify that the squareFeet in the current quote matches the actual_sqft from the previous mission's final audit.

Why this is critical for your $2.2M goal:
Prevents "Under-quoting": Salespeople often underestimate "Fly-out" logistics. The Auditor won't let a quote pass without hotel/per-diem logic if the distance is >250 miles.

Enforces LoD Value: If a tech is doing LoD 350 (more work), the Auditor ensures the company is getting paid for that extra precision.

Standardizes Agataâ€™s QC: Agata doesn't have to be a math genius; she just has to look for the "Green Checkmarks" from the Auditor.